---
templateKey: blog-post
title: シェルプログラムの基本
date: 2021-02-21
description:
cover: /images/bash.png
category: ShellScript
tags:
  - ShellScript
slug: shell-1
---

シェルプログラムの先頭には`#!/bin/sh`を書きます。

シェルプログラムのファイルには実行権限(xフラグ)を与える。

`#`はコメントとして扱われます。

```sh
#!/bin/sh
#
# comment
# comment comment
echo "Hello World. # comment ";
```

また、上記の様にダブルクォーテーションで囲むと、
echoコマンドの引数として扱われるため、コメントとしては取り扱われません。

```sh
./comment
Hello World. # comment
```

## 改行

コマンドは改行することで1つのコマンドとして区切られます。

改行を無視する場合、は`\`を利用する

```sh
echo Hello \
then else> World.
Hello World.
```

`\`の前にスペースをいくら入力しても、1つのスペースに置き換えられる点に注意が必要です。

```sh
echo Hello     \
then else> world.
Hello world.
```

## ワイルドカード


|ワイルドカード|説明|
|---|---|
|*|文字列全部|
|?|一文字|
|[...]|[ ]の中に含まれる文字のどれか1つ|
|[!...]|[ ]に含まれない文字|

|例||
|---|---|
|*abc|〜abcの様に、abcで終わるファイル。`abc`というファイル名でもOK|
|\*abc\*|ファイルの中に`abc`が含まれる文字列。|
|[a-z]\*|`a`から`z`までの文字のどれかで始まるファイル。|
|[-a-z]\*|`-`か`a`から`z`で始まるどれかで始まるファイル|
|a-zA-Z]\*|アルファベットの大文字か小文字で始まるファイル|
|\*[0-9]\*|ファイル名の中に数字が含まれるファイル|
|[!0-9]\*|数字では始まらないファイル|
|??|2文字のファイル|
|??*|2文字以上のファイル|
|abc/*|`abc`というディレクトリ下の全ファイル|

## 隠しファイル

`.`で始まるファイルを隠しファイルといいます。

隠しファイルはワイルドカードを利用しても除外されます。

```sh
ls -a
.          .Xdefaults .exrc      ZZZ        dir_a      xyz
..         .cshrc     ABC        def        ghi
```
  
```sh
ls
ABC   ZZZ   def   dir_a ghi   xyz
```

```sh
ls .*
.Xdefaults .cshrc     .exrc
```

```sh
ls .*rc
.cshrc .exrc
```

## 引用符（クォーテーション）の使い方

1. バックスラッシュ`\`を使う
2. シングルクォートで囲む。
3. ダブルクォートで囲む。

ワイルドカードカード等のシェルにとって特別な文字は、メタキャラクタと呼ぶ。

`;`、`&`、`(`、`)`、`|`、`~`、`<`、`>`、`?`、`*`、`[`、
`]`、`$`、`'`、`"`、`バッククォート`、`{`、`}`、`改行`、`タブ`、`スペース`


### バックスラッシュ
1文字をクォートするにはバックスラッシュを使います。

```sh
echo abc\\def
abc\def
```

### シングルクォート

シングルクォートで囲まれた文字列はすべて普通の文字となる。

### ダブルクウォート

ダブルクォーテーションはほとんどすべての文字をエスケープしますが、
`$`、バッククオート、`\`という3つの特殊文字はエスケープしません。

- ダブルクォートで囲んだ場合は`$`を利用した場合に変数名で展開される
- バックスラッシュの直後の文字が`$`の場合はエスケープされる
- シングルクォートの場合は展開されず、すべての特殊文字がエスケープされる

### クォーテーションを使うタイミング

コマンドの引数がシェルに解釈されないようにしたいときに利用する。

シェルがそれを解釈してもよいかどうかを考えて利用する。

```sh
echo *
ABC ZZZ def dir_a ghi xyz
echo "*"
*
```

### クォーテーションの使い分け

囲んだ文字列の中で、変数の置き換えやコマンド置き換えした結果を使いたいときは、
ダブルクォートを使う。

```sh
FILE=testfile
echo "Cannot remove $FILE"
Cannot remove testfile
```

```sh
echo "Today is `date`"
Today is 2021年 2月22日 月曜日 22時34分07秒 JST
```

シングルクォートはそのままの文字として使いたい場合です。

シングルクォートはダブルクォートをエスケープでき、

ダブルクォートはシングルクォートをエスケープします。

```sh
echo "'abc'"
'abc'
echo '"abc"'
"abc"
```

バックスラッシュをエスケープするには、
シングルクォートでもバックスラッシュでも可能です。

シングルクォートの中で変数を展開したい場合は、以下のように書く

```sh
'Part1'"Part2"'Part3'
```

## バッククォートによるコマンド置き換え

バッククォートはその中に書かれたコマンドを実行し、その結果をその位置に書き込みます。

```sh
echo "Today is `date`"
Today is 2021年 2月22日 月曜日 22時45分15秒 JST
```
バッククォートをバックスラッシュでエスケープすることにより、
コマンド置き換えのネストも可能です。

```sh
STRING=`echo "abc \`echo def\` ghi"`
echo $STRING
abc def ghi
```

最初に`echo def`の部分が置き換えられ、その後`echo "abc def ghi"`が実行されます。

以下が同じ意味のコマンドです。

```sh
TMPSTR=`echo def`
STRING=`echo "abc $TMPSTR ghi"`
echo $STRING
abc def ghi
```

## コマンド終了時のステータス

コマンドは慣例として、正しく終了したときは0、失敗したときは、1が終了時にセットされ、
エクジットステータスと言う。

|exit status|実行結果|正誤|
|---|---|---|
|0|成功|true|
|1|失敗|false|

またexit statusはコマンドを実行した直後に`$?`という変数に代入される。

```sh
echo $?
0
```

## コマンドセパレータ

コマンドは通常改行でコマンド行となりますが、その他にもコマンドの区切りとするものがあります。

これらをまとめてコマンドセパレータと呼びます。

|コマンドセパレータ|説明|
|---|---|
|改行|1つのコマンドの区切り|
|;|1つのコマンドの区切り|
|&#124;|出力された結果を次のコマンドの入力にする|

