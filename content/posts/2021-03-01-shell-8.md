---
templateKey: blog-post
title: シェルの色々な機能
date: 2021-03-02
description:
cover: /images/bash.png
category: ShellScript
tags:
  - ShellScript
slug: shell-8
---

## 数値の計算

シェルは変数を文字列として取扱い、数値としては考えません。

数字であってもそれは数値ではなく文字として扱われているだけです。

計算処理を行うには`expr`コマンドを利用します。

### 整数の計算

```bash
expr 1 + 1
2
```

```bash
expr 1 - 2
-1
```

```bash
expr 2 \* 2
4
expr 4 '*' 3
12
```

```bash
expr 4 / 2
2
```

```bash
expr 4 % 3
1
```

掛け算の`*`は必ずクォーテーションをつける必要があります。

### 変数の利用

変数を使って計算させた数値を元の変数に代入する例です。

```bash
VALUE=1
VALUE=`expr $VALUE + 1`
echo $VALUE
2
```

### 数値の比較

数値の大小を比較する場合は`test`コマンドが利用できます。

```bash
test int1 -eq int2
test int1 -ne int2
test int1 -lt int2
test int1 -le int2
test int1 -gt int2
test int1 -ge int2
```

### 浮動小数点を含む計算

浮動小数点を含む計算を行う場合は`bc`コマンドが利用できます。

小数第何位まで出力するかを`scale=n`で指定します。

```bash
echo "scale=n; num1 + num2" | bc # num1にnum2を加える
echo "scale=n; num1 - num2" | bc # num1にnum2を引く
echo "scale=n; num1 * num2" | bc # num1にnum2を掛ける
echo "scale=n; num1 / num2" | bc # num1にnum2を割る
```

```bash
echo "scale=3; 10 / 3" | bc
3.333
echo "scale=4; 10 / 3" | bc
3.3333
echo "scale=3; 3.33 / 3.1234" | bc
1.066
echo "scale=7; 3.33 / 3.1234" | bc
1.0661458
echo "3.5678 / 3" | bc
1
echo "scale=2; 3.5678 / 3" | bc
1.18
```

### 数値かどうかの判定

```bash
cat is_numeric
#!/bin/sh
NUMBER=$1
expr "$NUMBER" + 1 > /dev/null 2>&1
if [ $? -lt 2 ]; then
	echo "Numeric"
else
	echo "Not Numeric"
fi
```

計算結果（標準エラー出力の結果を標準出力にマージしたもの）
を`/dev/null`に捨てます。

`$?`はコマンド実行時の終了ステータスを表す関数で、

$NUMBERの値が数値であれば、`$?`には終了ステータス`0`（計算結果が0の場合のみ`1`）が代入されます。

また、$NUMBERの値が数値でなければ、、`$?`には`2`が代入されます。

上記スクリプトの実行例です。

```bash
./is_numeric 3
Numeric
```
```bash
./is_numeric
Not Numeric
```

### カラムに対する計算

```bash
COLUMN=5
ls -l | awk '{total += $'$COLUMN'} END {print total}'
```

`awk`は1行ずつ行を読み込み処理します。

5番目のカラムの値を足していきます。

ENDの後は、全部の行を処理した後に実行されます。

```bash
ls -l
total 24
-rw-r--r--  1 jun  staff  17  3  2 22:28 aaa
-rw-r--r--  1 jun  staff   5  3  2 22:28 bbb
-rw-r--r--  1 jun  staff  24  3  2 22:28 ccc
```

```bash
COLUMN=5
ls -l | awk '{total += $'$COLUMN'} END {print total}'
```

## 文字列の操作

### フィルタを使った文字列処理

```bash
$ STRING="abc def ghi"
$ STRING=`echo "$STRING" | sed -e "s/def/xyz/g"`
$ echo "$STRING"
abc xyz ghi
```

`echo "$STRING" | sed -e "s/def/xyz/g"`で出力された文字列`abc xyz ghi`が
標準出力に出力されますが、その値をSTRINGに再代入しています。

実行した結果をバッククォートで囲むことで、元の変数に代入できます。

### 文字列の連結
