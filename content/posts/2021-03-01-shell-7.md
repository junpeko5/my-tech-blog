---
templateKey: blog-post
title: フィルタの使用法
date: 2021-03-01
description:
cover: /images/bash.png
category: ShellScript
tags:
  - ShellScript
slug: shell-7
---

## sedコマンド

標準入力からデータを受け取って編集後の結果を標準出力に書き出します。

```bash
cat samplefile
OldTextjahjsaOldTextajs
mmmnnnn
hasjhOldTexthajsh
```
```bash
sed -e "s/OldText/NewText/" samplefile
NewTextjahjsaOldTextajs
mmmnnnn
hasjhNewTexthajsh
```

結果を残す場合は、リダイレクトさせます。

```bash
sed -e "s/OldText/NewText/" samplefile > resultfile
```

`sed`につけた`-e`というオプションは、その後の文字列が編集用のコマンドだということ
を表します。

`s`は置き換え（substitute)の意味です。`s/OldText/NewText/`と書くことで、
2つの文字列の左側の文字を右側の文字に置き換えます。

1行の中で見つけた文字列を全て置き換える場合には
`s/OldText/NewText/g`と指定します。

```bash
sed -e "s/OldText/NewText/g" samplefile
NewTextjahjsaNewTextajs
mmmnnnn
hasjhNewTexthajsh
```

`-n`コマンドは指示した行のみ実行するように指定できます。

```bash
sed -n '2p' < samplefile
mmmnnnn
```

```bash
sed -n '3p' < samplefile
hasjhOldTexthajsh
```

置き換えた行のみ表示する場合は以下のようになります。

```bash
sed -n -e "s/OldText/NewText/gp" samplefile
NewTextjahjsaNewTextajs
hasjhNewTexthajsh
```

## sedコマンドをパイプでつなぐ

```bash
cat samplefile |
sed -e "s/OldText/Newtext/g" |
sed -e "s/mmm/MMM/g" |
while read LINE
do
echo $LINE
done
```

出力結果⏬

```bash
NewtextjahjsaNewtextajs
MMMnnnn
hasjhNewtexthajsh
```

## sedコマンドのデリミタについて

sedコマンドのデリミタ`/`は変更可能です。

`s`の後の次の文字がデリミタとして認識される仕様となっており、
慣習的に`/`が使われますが、`%`や`@`を使っても問題ありません。

```bash
cat samplefile |
sed -e "s%OldText%Newtext%g"
NewtextjahjsaNewtextajs
mmmnnnn
hasjhNewtexthajsh
```

## sedコマンドでの編集について

### 文字列の変換

```bash
sed -e "s/OldText/NewText/g"
```

`g`があれば、行の全てを対象（globallyの略）にします。

### 文字列の削除

```bash
sed -e "s/TextToRemove//g"
```

何もない文字列に返還させると文字列を結果的に削除できます。

### 行頭の文字列を消す

```bash
sed -e "s/^TextToRemove//"
```

行頭の文字が指定した文字列に一致すれば削除する例です。

### 行末の文字列を消す

```bash
sed -e "s/TextToRemove\$//"
```

### 文字列を追加する

```bash
sed -e "s/nnnn/nnnnAddText/" samplefile
OldTextjahjsaOldTextajs
mmmAddText
hasjhOldTexthajsh
```
`nnnn`という文字列の後に`AddText`という文字を追加します。

### 行の先頭に文字列を追加する

```bash
sed -e "s/^/AddText/" samplefile
AddTextOldTextjahjsaOldTextajs
AddTextmmmnnnn
AddTexthasjhOldTexthajsh
```

### 行末に文字列を追加する

```bash
sed -e "s/\$/AddText/" samplefile
OldTextjahjsaOldTextajsAddText
mmmnnnnAddText
hasjhOldTexthajshAddText
```

### ドットとアスタリスク

`.`には任意の1文字の意味があります。シェルの特殊文字`?`と似たような働きを持ちます。

```bash
sed -e "s/^...//" samplefile
TextjahjsaOldTextajs
nnnn
jhOldTexthajsh
```

行頭の3文字を削除しています。

`*`は直前の文字が任意の個数連続した場合（0も含む）を表します。

`a*`という指定は、a、aa、aaaaaなどaが任意の個数続く文字列を表します。

`.*`を指定すると、任意の文字列を表します。

```bash
sed -e "s/.*/abcd/" samplefile
abcd
abcd
abcd
```

`.*`は全ての文字列に当てはまるため、行を全て、`abcd`に置き換えます。

### 文字列の切り詰め、切り取り

以下のファイルがあるとします。

```bash
cat file
abcdefghijklmn
opqrstuvwxyz
0123456789
abc(defgh)aijkl
mn(op)qrstuvwxyz
```

e以降の5文字をABCに置き換えます。

```bash
sed -e "s/e...../ABC/" file
abcdABCklmn
opqrstuvwxyz
0123456789
abc(dABCijkl
mn(op)qrstuvwxyz
```

sを含めsより前の文字を切り取り

```bash
sed -e "s/.*s//" file
abcdefghijklmn
tuvwxyz
0123456789
abc(defgh)aijkl
tuvwxyz
```

全ての行をXYZに置き換えます。

```bash
sed -e "s/.*/XYZ/" file
XYZ
XYZ
XYZ
XYZ
XYZ
```

カッコの中の文字を全て消去

```bash
sed -e "s/(.*)/()/" file
abcdefghijklmn
opqrstuvwxyz
0123456789
abc()aijkl
mn()qrstuvwxyz
```

`id`コマンドから最初のuidを取り出す。

```bash
id | sed -e "s/uid=//" -e "s/(.*//"
```

`id`コマンドから最初のユーザー名を取り出す。

```bash
id | sed 's/uid=.*(\(.*\)) gid=.*/\1/'
```
`\1`は丸括弧で囲んだ部分を1つ目を取り出せる。

丸括弧は文字列として扱われないようにエスケープする。

### ある文字の最初からn文字を切り取る

```bash
echo "$STRING" | cut -c1-5
```

```bash
#!/bin/sh
STRING=abcdefghijklmlopqrstuvwxyz
FIRST=1
LEN=5
echo $STRING | cut -c$FIRST-$LEN
```

行頭FIRST番目からLEN文字分を切り取ります。

### awkコマンドで行頭の文字を切り取る

```bash
awk '{printf "%-.5s\n", $0}' < file
abcde
opqrs
01234
abc(d
mn(op
```

sedコマンドでは以下のようになります。

```bash
sed -e "s/^\(.....\).*/\1/" file
abcde
opqrs
01234
abc(d
mn(op
```